<?php


    $cad='{"@timestamp": "2021-12-14T02:37:47.057+0000","@version":"1","log_type":"LOG","log_level":"DEBUG","level_value":10000,"logger_name":"com.qvantel.adapter.aml.AmlAdapter$$anon$1","service_name":"adapter-aml","artifact_id":"artifactory.qvantel.net/adapter-aml:1.0.1.20211029072949_develop_a894d866","trace_token":"undefined","thread_name":"adapter-aml-akka.actor.default-dispatcher-3165","message": "Got message with key: null, value: {\"EVENT_INFORMATION\":{\"EVENT_SOURCE\":\"some-source\",\"EVENT_DATE\":\"2021-12-13 22:37:46.785\",\"EVENT_VERSION\":\"2.0\",\"EVENT_TYPE\":\"Transaction\",\"EVENT_ID\":\"1639449466785\"},\"TRANSACTION\":{\"CURRENCY_ID\":\"BOB\",\"MOVEMENTS\":[{\"INVOICE_NUMBER_ID\":\"\",\"FEE\":\"0.00000000\",\"MOVEMENT_TYPE\":\"1\",\"IS_REVERSIBLE\":\"1\",\"LEVEL\":\"5000\",\"COMMISSION\":\"0.00000000\",\"WALLET_TYPE_ID\":\"1\",\"AMOUNT\":\"-10.00000000\",\"MOVEMENT_ID\":\"445655214\",\"TS_MOVEMENT\":\"2021-12-13 22:38:00:26485500\",\"COMMISSION_ID\":\"\",\"AGENT_OR_SUBSCRIBER_ID\":\"14365693\",\"INITIAL_BALANCE\":\"2902.15000000\",\"ENDING_BALANCE\":\"2892.15000000\",\"IS_BATCH\":\"false\"},{\"INVOICE_NUMBER_ID\":\"\",\"FEE\":\"4.00000000\",\"MOVEMENT_TYPE\":\"3\",\"IS_REVERSIBLE\":\"1\",\"LEVEL\":\"5000\",\"COMMISSION\":\"0.00000000\",\"WALLET_TYPE_ID\":\"1\",\"AMOUNT\":\"-4.00000000\",\"MOVEMENT_ID\":\"445655215\",\"TS_MOVEMENT\":\"2021-12-13 22:38:00:26681800\",\"COMMISSION_ID\":\"20902\",\"AGENT_OR_SUBSCRIBER_ID\":\"14365693\",\"INITIAL_BALANCE\":\"2892.15000000\",\"ENDING_BALANCE\":\"2888.15000000\",\"IS_BATCH\":\"false\"},{\"INVOICE_NUMBER_ID\":\"\",\"FEE\":\"4.00000000\",\"MOVEMENT_TYPE\":\"2\",\"IS_REVERSIBLE\":\"1\",\"LEVEL\":\"1300\",\"COMMISSION\":\"0.00000000\",\"WALLET_TYPE_ID\":\"1\",\"AMOUNT\":\"4.00000000\",\"MOVEMENT_ID\":\"NULL\",\"TS_MOVEMENT\":\"2021-12-13 22:38:00:27038000\",\"COMMISSION_ID\":\"20902\",\"AGENT_OR_SUBSCRIBER_ID\":\"10353\",\"INITIAL_BALANCE\":\"0.00000000\",\"ENDING_BALANCE\":\"0.00000000\",\"IS_BATCH\":\"true\"},{\"INVOICE_NUMBER_ID\":\"\",\"FEE\":\"0.00000000\",\"MOVEMENT_TYPE\":\"0\",\"IS_REVERSIBLE\":\"1\",\"LEVEL\":\"1200\",\"COMMISSION\":\"0.00000000\",\"WALLET_TYPE_ID\":\"1\",\"AMOUNT\":\"10.00000000\",\"MOVEMENT_ID\":\"445655216\",\"TS_MOVEMENT\":\"2021-12-13 22:38:00:26813600\",\"COMMISSION_ID\":\"\",\"AGENT_OR_SUBSCRIBER_ID\":\"11398555\",\"INITIAL_BALANCE\":\"2683428.38850000\",\"ENDING_BALANCE\":\"2683438.38850000\",\"IS_BATCH\":\"false\"}],\"TRANSACTION INFORMATION\":[{\"INFO_DATA\":\"rfesg5S5VFPfU4Kb\",\"INFO_KEY\":\"INFO_TRX_UTFI\"},{\"INFO_DATA\":\"\",\"INFO_KEY\":\"INFO_RESERVE_AUXILIARY_VALUE\"},{\"INFO_DATA\":\"\",\"INFO_KEY\":\"INFO_TRX_DESCRIPTION\"},{\"INFO_DATA\":\"\",\"INFO_KEY\":\"INFO_BATCH_ID\"},{\"INFO_DATA\":\"\",\"INFO_KEY\":\"INFO_REQUEST_TRX_ID\"},{\"INFO_DATA\":\"externalDetails\",\"INFO_KEY\":\"DETAILS\"},{\"INFO_DATA\":\"\",\"INFO_KEY\":\"SOURCE_USER_DOCUMENT\"},{\"INFO_DATA\":\"\",\"INFO_KEY\":\"TARGET_USER_DOCUMENT\"},{\"INFO_DATA\":\"externalDetails\",\"INFO_KEY\":\"externalDetails\"},{\"INFO_DATA\":\"achwithdrawal\",\"INFO_KEY\":\"service\"}],\"MOVEMENT_QUANTITY\":\"4\",\"REV_TRANSACTION_ID\":\"\",\"TARGET_DEVICE_ID\":\"111259546\",\"ERROR_CODE\":\"\",\"TARGET_DEVICE_KEY\":\"ach\",\"INTERFACE\":\"WS\",\"AMOUNT\":\"10.00000000\",\"EXTERNAL_ID\":\"\",\"SERVICE_ID\":\"41\",\"SOURCE_DEVICE_ID\":\"117799531\",\"TS_TRANSACTION\":\"2021-12-13 22:38:00\",\"SOURCE_DEVICE_TYPE_ID\":\"MOBILE\",\"EXECUTOR_DEVICE_KEY\":\"75561346\",\"DP_INFORMATION\":[{\"FIELD_VALUE\":\"14365693\",\"FIELD_KEY\":\"CLIENT_ID\"},{\"FIELD_VALUE\":\"2\",\"FIELD_KEY\":\"CLIENT_ROLE\"},{\"FIELD_VALUE\":\"0\",\"FIELD_KEY\":\"STATUS_ID\"},{\"FIELD_VALUE\":\"3\",\"FIELD_KEY\":\"KYC\"},{\"FIELD_VALUE\":\"5000\",\"FIELD_KEY\":\"LEVEL_ID\"},{\"FIELD_VALUE\":\"CI\",\"FIELD_KEY\":\"DOCUMENT_TYPE\"},{\"FIELD_VALUE\":\"5373280\",\"FIELD_KEY\":\"DOCUMENT_NUMBER\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"RUC\"},{\"FIELD_VALUE\":\"2021-08-04 19:32:59\",\"FIELD_KEY\":\"CREATION_DATE\"},{\"FIELD_VALUE\":\"1900-01-01\",\"FIELD_KEY\":\"BIRTH_DATE\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"BLOCKADE_DATE\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"DELETED\"},{\"FIELD_VALUE\":\"ES\",\"FIELD_KEY\":\"LANGUAGE\"},{\"FIELD_VALUE\":\"2021-12-13 22:32:44\",\"FIELD_KEY\":\"LAST_TRANSACTION_DATE\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"PARENT_ID\"},{\"FIELD_VALUE\":\"117799531\",\"FIELD_KEY\":\"CONTACT_DEVICE_ID\"},{\"FIELD_VALUE\":\"Mario Cortez\",\"FIELD_KEY\":\"CLIENT_DESCRIPTION\"},{\"FIELD_VALUE\":\"117796150\",\"FIELD_KEY\":\"MODIFIED_BY\"},{\"FIELD_VALUE\":\"2021-11-10 10:48:44\",\"FIELD_KEY\":\"MODIFICATION_DATE\"},{\"FIELD_VALUE\":\"0\",\"FIELD_KEY\":\"CREATED_BY\"},{\"FIELD_VALUE\":\"14365693\",\"FIELD_KEY\":\"SUBSCRIBER_ID\"},{\"FIELD_VALUE\":\"1\",\"FIELD_KEY\":\"BRAND_ID\"},{\"FIELD_VALUE\":\"Mario\",\"FIELD_KEY\":\"NAME\"},{\"FIELD_VALUE\":\"Cortez\",\"FIELD_KEY\":\"SURNAME\"},{\"FIELD_VALUE\":\"BO\",\"FIELD_KEY\":\"NATIONALITY\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"CONTACT_PHONE\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"NEIGHBORHOOD\"},{\"FIELD_VALUE\":\"1\",\"FIELD_KEY\":\"CITY\"},{\"FIELD_VALUE\":\"1\",\"FIELD_KEY\":\"DEPARTMENT\"},{\"FIELD_VALUE\":\"doble via\",\"FIELD_KEY\":\"STREET\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"DOOR_NUMBER\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"FLOOR\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"APARTMENT\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"VENDOR_ID\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"REMITTANCE\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"REMITTANCE_DATE\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"REMITTANCE_VENDOR_ID\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"KEY_WORD\"},{\"FIELD_VALUE\":\"1\",\"FIELD_KEY\":\"CITY_ID\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"NORMAL_STATUS_USER_ID\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"NORMAL_STATUS_TS\"},{\"FIELD_VALUE\":\"M\",\"FIELD_KEY\":\"GENDER\"},{\"FIELD_VALUE\":\"gchlDealer\",\"FIELD_KEY\":\"DEALER\"},{\"FIELD_VALUE\":\"doble via\",\"FIELD_KEY\":\"DIRECCION\"},{\"FIELD_VALUE\":\"mct.informatico@gmail.com\",\"FIELD_KEY\":\"EMAIL\"},{\"FIELD_VALUE\":\"3750859\",\"FIELD_KEY\":\"IDPDV\"},{\"FIELD_VALUE\":\"{\"DEVICE_ID\":117799531,\"DEVICE_TYPE_ID\":\"MOBILE\",\"DEVICE_KEY\":\"75561346\",\"STATUS\":0,\"CREATION_DATE\":\"2021-08-04 19:33:00\",\"LAST_ACCESS\":\"2021-12-13 22:37:44\",\"DELETED\":\"0\",\"DELETED_DATE\":\"\",\"ACCESS_ERROR_COUNTER\":0,\"MOBILE_OPERATOR_ID\":\"74000\"}\",\"FIELD_KEY\":\"CONTACT_DEVICE\"},{\"FIELD_VALUE\":\"0\",\"FIELD_KEY\":\"MUST_ACCEPT_TERMS_AND_CONDITIONS\"}],\"DESCRIPTION_TEXT\":\"Envio de Dinero destino ACH\",\"SOURCE_DEVICE_KEY\":\"MOBILE\",\"STEP\":\"0\",\"TARGET_DEVICE_TYPE_ID\":\"MOBILE\",\"TRANSACTION_TYPE\":\"2\",\"CP_INFORMATION\":[{\"FIELD_VALUE\":\"11398555\",\"FIELD_KEY\":\"CLIENT_ID\"},{\"FIELD_VALUE\":\"1\",\"FIELD_KEY\":\"CLIENT_ROLE\"},{\"FIELD_VALUE\":\"0\",\"FIELD_KEY\":\"STATUS_ID\"},{\"FIELD_VALUE\":\"9\",\"FIELD_KEY\":\"KYC\"},{\"FIELD_VALUE\":\"1200\",\"FIELD_KEY\":\"LEVEL_ID\"},{\"FIELD_VALUE\":\"CI\",\"FIELD_KEY\":\"DOCUMENT_TYPE\"},{\"FIELD_VALUE\":\"204622021\",\"FIELD_KEY\":\"DOCUMENT_NUMBER\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"RUC\"},{\"FIELD_VALUE\":\"2016-07-19 11:28:01\",\"FIELD_KEY\":\"CREATION_DATE\"},{\"FIELD_VALUE\":\"1773-06-01\",\"FIELD_KEY\":\"BIRTH_DATE\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"BLOCKADE_DATE\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"DELETED\"},{\"FIELD_VALUE\":\"ES\",\"FIELD_KEY\":\"LANGUAGE\"},{\"FIELD_VALUE\":\"2021-12-13 22:30:40\",\"FIELD_KEY\":\"LAST_TRANSACTION_DATE\"},{\"FIELD_VALUE\":\"0\",\"FIELD_KEY\":\"PARENT_ID\"},{\"FIELD_VALUE\":\"111259546\",\"FIELD_KEY\":\"CONTACT_DEVICE_ID\"},{\"FIELD_VALUE\":\"Cliente 11398555\",\"FIELD_KEY\":\"CLIENT_DESCRIPTION\"},{\"FIELD_VALUE\":\"117529275\",\"FIELD_KEY\":\"MODIFIED_BY\"},{\"FIELD_VALUE\":\"2020-10-28 11:57:55\",\"FIELD_KEY\":\"MODIFICATION_DATE\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"CREATED_BY\"},{\"FIELD_VALUE\":\"11398555\",\"FIELD_KEY\":\"AGENT_ID\"},{\"FIELD_VALUE\":\"1\",\"FIELD_KEY\":\"AGENT_GROUP_ID\"},{\"FIELD_VALUE\":\"Santa Cruz\",\"FIELD_KEY\":\"CITY\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"VENDOR_ID\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"POINT_OF_SALE\"},{\"FIELD_VALUE\":\"1\",\"FIELD_KEY\":\"AGENT_CLASS_ID\"},{\"FIELD_VALUE\":\"Cliente 11398555\",\"FIELD_KEY\":\"TRADE_NAME\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"CENTRE\"},{\"FIELD_VALUE\":\"Cliente 11398555\",\"FIELD_KEY\":\"OWNER_NAME\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"CONTACT\"},{\"FIELD_VALUE\":\"Direccion\",\"FIELD_KEY\":\"ADDRESS\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"ADDRESS2\"},{\"FIELD_VALUE\":\"Santa Cruz\",\"FIELD_KEY\":\"NEIGHBORHOOD\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"PHONE_NUMBER\"},{\"FIELD_VALUE\":\"\",\"FIELD_KEY\":\"REFERENCE\"},{\"FIELD_VALUE\":\"7\",\"FIELD_KEY\":\"CITY_ID\"},{\"FIELD_VALUE\":\"ach\",\"FIELD_KEY\":\"ACCOUNT_MOBILE_NUMBER\"},{\"FIELD_VALUE\":\"Direccion\",\"FIELD_KEY\":\"ADDRESS_LEG\"},{\"FIELD_VALUE\":\"0\",\"FIELD_KEY\":\"CAPSET_ID\"},{\"FIELD_VALUE\":\"204622021\",\"FIELD_KEY\":\"CI\"},{\"FIELD_VALUE\":\"ACH\",\"FIELD_KEY\":\"DEALER\"},{\"FIELD_VALUE\":\"Direccion\",\"FIELD_KEY\":\"DIRECTION\"},{\"FIELD_VALUE\":\"0\",\"FIELD_KEY\":\"INVOICE\"},{\"FIELD_VALUE\":\"204622021\",\"FIELD_KEY\":\"NIT\"},{\"FIELD_VALUE\":\"{\"DEVICE_ID\":111259546,\"DEVICE_TYPE_ID\":\"MOBILE\",\"DEVICE_KEY\":\"ach\",\"STATUS\":0,\"CREATION_DATE\":\"2016-07-19 11:28:01\",\"LAST_ACCESS\":\"2021-12-13 22:30:26\",\"DELETED\":\"0\",\"DELETED_DATE\":\"\",\"ACCESS_ERROR_COUNTER\":0,\"MOBILE_OPERATOR_ID\":\"74000\"}\",\"FIELD_KEY\":\"CONTACT_DEVICE\"},{\"FIELD_VALUE\":\"0\",\"FIELD_KEY\":\"MUST_ACCEPT_TERMS_AND_CONDITIONS\"}],\"DESTINATION\":\"11398555\",\"SOURCE\":\"14365693\",\"EXECUTOR_DEVICE_TYPE_ID\":\"MOBILE\",\"EXECUTOR_DEVICE_ID\":\"117799531\",\"TRANSACTION_ID\":\"2000153647\",\"RESULT\":\"0\"},\"OPERATION_ID\":\"rfesg5S5VFPfU4Kb\"}"}';
//    trama($cad);
    json($cad);

    function trama($cad)
    {
    $mystring = $cad;
    $ext= strlen($mystring);
    $findme   = 'Prepared Soap payload Message:';
    $pos = strpos($mystring, $findme); $pos=$pos + 31;
    $resp= substr($mystring, $pos, ($ext - $pos)-3);
    //$resp2= str_replace('\\', ' ', $resp);
    echo $resp;
exit(0);            
    }




    function json($cad)
    {
    $mystring = $cad;
    $ext= strlen($mystring);
    $findme   = 'EVENT_INFORMATION';
    $pos = strpos($mystring, $findme);
    $resp= substr($mystring, $pos-3, ($ext - $pos+1));
    $resp2= str_replace('\\', ' ', $resp);
    echo $resp2;
      exit(0);      
    }
    
?>